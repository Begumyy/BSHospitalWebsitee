@* @{
    ViewData["Title"] = "Agent";
    Layout = "~/Views/Shared/_AgentLayout.cshtml";
} *@

<div class="row">
    <div class="col-lg-12 ">
        <div class="card border border-primary">
            <div class="card-header bg-primary border-primary">
                <h5 class="my-0 text-white"><i class="uil uil-message me-3"></i>Aranacaklar</h5>
            </div><!-- end card-header -->
            <div class="card-body">

                <table id="tblListAppointment" class="table table-striped table-bordered">
                </table>
            </div><!-- end card-body -->
        </div><!-- end card -->
    </div>
</div>

@section Scripts{
    <script type="text/javascript">

        $(document).ready(function () {
            aranacakListele();
        })

        function aranacakListele() {
            if ($.fn.DataTable.isDataTable('#tblListAppointment')) {
                $('#tblListAppointment').DataTable().destroy();
            }
            var DataTable = $("#tblListAppointment").DataTable({
                ajax: { url: '/Agent/DashboardAgent/GetAll', dataSrc: '' },
                columns: [
                    { data: 'id', title: 'ID' },
                    { data: 'hospital.hospitalName', title: 'Hastane Adı' }, 
                    { data: 'patient.patientName', title: 'Hasta Adı' },
                    { data: 'patient.tckn', title: 'TCKN' },
                    { data: 'patient.phone', title: 'Telefon' },
                    { data: 'patient.address', title: 'Adres' },
                    { data: 'patient.age', title: 'Yaş' },
                    { data: 'department.departmantName', title: 'Bölüm Adı' },
                    { data: 'doctor.doctorName', title: 'Doktor Adı' },

                    { data: 'appointmentDate', title: 'Randevu Tarihi' },
                    {
                        data: "id",
                        render: function (data, type, row) {
                            return `<a href="#" onclick="Decline(${data})" class="btn btn-sm btn-danger">sil</a><a href="#" onclick="Onaylandi(${data})" class="btn btn-sm btn-danger">Onaylandı</a> <a onclick="Accept('${data}','${row.department.departmantName}','${row.hospital.hospitalName}','${row.doctor.doctorName}','${row.patient.patientName}','${row.patient.tckn}','${row.patient.phone}','${row.patient.address}','${row.patient.age}')" class="btn btn-sm btn-primary">Onaylanmadı</a>`;
                        }

                    },


                ]
            });
        }

        // function Decline(id) {
        //     let deleteee = { id: id }
        //     $.ajax({
        //         type: "POST",
        //         url: "/Agent/Appointment/DeleteById",
        //         data: deleteee,
        //         success: function () {
        //             aranacakListele()
        //         }
        //     })
        //}


        // function Accept(id, hospitalId, patientName, tckn, age, address, phone, departmantId, doctorId, appointmentDate) {
        //     $("input").val("");

        //     fillListHospital(hospitalId);
        //     $("#ddlHospital").val(hospitalId);
        //     fillListDepartment(departmantId);
        //     $("#ddlDepartment").val(departmantId);
        //     fillListDoctor(doctorId);
        //     $("#ddlDoctor").val(doctorId);
        //     $("#txtAppointment").val(appointmentDate);

        //     $("#txtName").val(patientName);
        //     $("#txtTCKN").val(tckn);
        //     $("#txtAdres").val(address);
        //     $("#txtPhone").val(phone);
        //     $("#txtYas").val(age);
        //     $("#modalId").modal("show");
        //     $("#modalTitleId").text("Randevu Güncelle ");
        //     $("#btnAppointment").text("Guncelle");

        //     $("#btnAppointment").off();


        //     $("#btnAppointment").click(function () {

        //         $.ajax({
        //             type: "POST",
        //             url: "/Agent/Appointment/Update",
        //             data: {
        //                 id: id,
        //                 hospitalId: $("#ddlHospital").val(),
        //                 departmentId: $("#ddlDepartment").val(),
        //                 doctorId: $("#ddlDoctor").val(),
        //                 appointmentDate: $("#txtAppointment").val(),

        //                 patient: {
        //                     patientName: $("#txtName").val(),
        //                     tckn: $("#txtTCKN").val(),
        //                     address: $("#txtAdres").val(),
        //                     Phone: $("#txtPhone").val(),
        //                     age: $("#txtYas").val(),
        //                     departmentId: $("#ddlDepartment").val(),
        //                 }
        //             },
        //             success: function () {
        //                 alert("Güncelleme Yapıldı");
        //                 $("#modalId").modal("hide");
        //                 aranacakListele();
        //             }
        //         })
        //     })
        // }



        // function Accept(id) {
        //     $.ajax({
        //         type: "POST",
        //         url: "/Agent/Appointment/Accept",
        //         data: { id: id },
        //         success: function (response) {
        //             alert("Randevu Onaylandı");
        //             aranacakListele();
        //         },
        //         error: function (err) {
        //             alert("Randevu bulunamadı veya bir hata oluştu");
        //         }
        //     });
        // }

        function Decline(id) {
            $.ajax({
                type: "POST",
                url: "/Agent/DashboardAgent/DeleteById",
                data: { id: id },
                success: function (response) {
                    alert("Randevu İptal Edildi");
                    aranacakListele();
                },
                error: function (err) {
                    alert("Randevu bulunamadı veya bir hata oluştu");
                }
            });
        }
        function Onaylandi(id) {
            $.ajax({
                type: "POST",
                url: "/Agent/Onaylananlar/AcceptById",
                data: { id: id },
                success: function (response) {
                    alert("Randevu Onaylandi");
                    aranacakListele();
                },
                error: function (err) {
                    alert("Randevu bulunamadı veya bir hata oluştu");
                }
            });
        }

    </script>
}

